<div class="valign-wrapper" style="width:100%;height:100%;position: absolute;">
    <div class="valign" style="height: 100%; width:100%;">
        <div class="container ">
            <div class="card-panel" style="background-color:#2b2f32 ">
                <div class="tittle">
                    <h2>Bienvenido <span id="username"><%- username %></span></h2>
                </div>

                <div class=" messagesContainer" id="messagesContainer" style="border-radius: 5px;overflow: scroll; min-height: 25rem; max-height:25rem; background-color:#0e1418; padding:10px">
                    <div class="mensaje-izq">
                        <div class="cuerpo_msj">
                            <div class="msj-texto">
                                <p class="text-blue italic">
                                    <%- username %>:
                                </p>
                                <p>{{ message }}</p>
                            </div>
                            <span class="tiempo"><i class="icon-clock"></i></span>
                        </div>
                    </div>
                </div>
                <!-- CAJON DE TEXTO -->
                <div class="container row" style="border-radius: 10px; margin-top:2rem; padding:1rem; background-color: #34383b">
                    <div id="newMessageForm" class="col s9" style="background-color: #85657c; border-radius: 10px">
                        <div class="input-field " style="margin:10px ">
                            <textarea placeholder="Escriba su mensaje." id="message" class="materialize-textarea"></textarea>
                        </div>
                    </div>
                    <div class="col s2" style="margin-top:1rem">
                        <button class="btn waves-effect waves-dark" type="submit" id="postMessageButton">
              Submit
              <i class="material-icons right"></i>
            </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var username = $("#username").val();

    var MessageModel = Backbone.Model.extend({
        urlRoot: "/messages"
    });

    var MessageCollection = Backbone.Collection.extend({
        url: "/messages",
        model: MessageModel
    });

    var messages = new MessageCollection();
    messages.fetch();

    $("#postMessageButton").click(function() {
        var messageText = $("#message").val();
        console.log(username);
        messages.create({
            message: messageText
        }, {
            wait: true
        });
        $("#message").val("");
    });
    _.templateSettings = {
        interpolate: /\{\{(.+?)\}\}/g
    };
    var MessagesView = Backbone.View.extend({
        el: "#messagesContainer",
        initialize: function() {
            this.collection.on("add", this.render, this);
            this.render();
        },

        template: _.template(
            '<div class="mensaje-izq"><div class="cuerpo_msj "><div class="msj-texto cyan darken-3"><h6><%- username %>:</h6><h6>{{ message }}</h6></div><span class="tiempo"><i class="icon-clock"></i></span></div></div>'
        ),
        render: function() {
            this.$el.html("");

            this.collection.each(function(msg) {
                console.log(msg);
                this.$el.append(this.template(msg.toJSON()));
            }, this);
            $("#messagesContainer").scrollTop(
                $("#messagesContainer").prop("scrollHeight")
            );
        }
    });
    var mView = new MessagesView({
        collection: messages
    });
</script>